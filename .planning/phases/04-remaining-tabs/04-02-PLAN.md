---
phase: 04-remaining-tabs
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/teamDashboard/skillsMockData.ts
  - lib/teamDashboard/skillsHelpers.ts
  - app/org/[orgId]/team/[teamId]/skillgraph/page.tsx
autonomous: true

must_haves:
  truths:
    - "Skills Graph tab shows SkillGraph visualization with member skill domain weights"
    - "View toggle switches between By Member and By Skill table views"
    - "Member skills table shows domain count, skill count, and top skills per member"
    - "Skill view table shows skill name, domain, usage, completion, contributors"
    - "Filter tabs sort members by domain breadth and skill proficiency"
    - "ChartInsights panel shows member-level skills insights"
  artifacts:
    - path: "lib/teamDashboard/skillsMockData.ts"
      provides: "Member skills mock data generator"
      exports: ["getMemberSkillsData", "getMemberSkillRows"]
    - path: "lib/teamDashboard/skillsHelpers.ts"
      provides: "Skills tab filter logic and insights"
      exports: ["getSkillsInsights"]
    - path: "app/org/[orgId]/team/[teamId]/skillgraph/page.tsx"
      provides: "Skills Graph tab page composition"
      contains: "SkillGraph"
  key_links:
    - from: "app/org/[orgId]/team/[teamId]/skillgraph/page.tsx"
      to: "lib/teamDashboard/skillsMockData.ts"
      via: "import and useMemo"
      pattern: "getMemberSkillsData"
    - from: "app/org/[orgId]/team/[teamId]/skillgraph/page.tsx"
      to: "components/skillmap/SkillGraph.tsx"
      via: "domainWeights and skillVisibility props"
      pattern: "SkillGraph.*domainWeights="
---

<objective>
Implement the Skills Graph tab for the team dashboard, showing member-level skill distribution with sunburst/treemap visualization and dual-view table.

Purpose: Enable users to analyze individual member skill breadth and proficiency, mirroring the org dashboard Skills Graph tab layout with member-level data and a "By Member" / "By Skill" toggle.
Output: Working Skills Graph tab at `/org/:orgId/team/:teamId/skillgraph` with SkillGraph, dual-view BaseTeamsTable, and ChartInsights.
</objective>

<execution_context>
@/Users/kartikmistry/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kartikmistry/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-remaining-tabs/04-RESEARCH.md

@app/org/[orgId]/skillgraph/page.tsx
@app/org/[orgId]/team/[teamId]/performance/page.tsx
@lib/teamDashboard/overviewMockData.ts
@lib/teamDashboard/types.ts
@lib/orgDashboard/skillgraphMockData.ts
@lib/orgDashboard/types.ts
@components/skillmap/SkillGraph.tsx
@components/dashboard/BaseTeamsTable.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Skills mock data generator and helpers</name>
  <files>
    lib/teamDashboard/skillsMockData.ts
    lib/teamDashboard/skillsHelpers.ts
  </files>
  <action>
Create `lib/teamDashboard/skillsMockData.ts`:

1. Define `MemberSkillsRow` type for "By Member" view:
   - `memberName: string`, `teamId: string`
   - `domainCount: number` (1-8 domains)
   - `skillCount: number` (3-25 skills)
   - `totalUsage: number` (sum of all skill usages)
   - `avgProficiency: number` (0-100, average skill completion)
   - `top3WidelyKnown: { name: string; color: string }[]`
   - `top3Proficient: { name: string; color: string }[]`
   - `domainDistribution: { domain: string; value: number }[]` (for SkillGraph domainWeights)
   - `details: { domain: string; skill: string; usage: number; progress: number }[]`

2. Define `MemberSkillRow` type for "By Skill" view (mirrors org `SkillgraphSkillRow`):
   - `skillName: string`, `domainName: string`
   - `totalUsage: number`, `avgUsage: number`, `totalSkillCompletion: number`, `contributors: number`
   - `details: { team: string; usage: number; progress: number }[]` (where "team" = member name for team dashboard)

3. Create `getMemberSkillsData(teamId: string, memberCount?: number)` function:
   - Reuse `getMemberPerformanceRowsForTeam` to get base member names
   - Use 8 standard domains: Frontend, Backend, DevOps, AI & ML, Mobile, Cloud, Testing, Product & Design
   - Use deterministic seed (member name charCode + index) to assign each member 3-7 domains
   - For each domain, generate 2-5 skills with deterministic usage (50-200) and progress (20-95%)
   - Calculate `totalUsage` as sum of all skill usages, `avgProficiency` as average progress
   - Assign `top3WidelyKnown` and `top3Proficient` from generated skills (highest usage and highest progress respectively)
   - Build `domainDistribution` from total usage per domain
   - Use skill names from existing `roadmapData` import (`@/components/skillmap/data/data`) or hardcode common skill names (React, TypeScript, Node.js, Python, Docker, Kubernetes, Swift, PyTorch, Figma, Jest, etc.)

4. Create `getMemberSkillRows(memberSkills: MemberSkillsRow[])` function:
   - Aggregates per-skill across all members for "By Skill" view
   - Returns `MemberSkillRow[]` with each unique skill, total usage across members, avg usage, avg completion, contributor count
   - `details` array maps member names as "team" entries (matching org SkillgraphSkillRow shape)

5. Create `computeDomainWeights(members: MemberSkillsRow[], visibleMembers: Record<string, boolean>)`:
   - Aggregates domain distributions for visible members only
   - Returns `Record<string, number>` format matching SkillGraph `domainWeights` prop
   - If no members visible, return undefined (shows default SkillGraph)

Create `lib/teamDashboard/skillsHelpers.ts`:

1. Define `SkillsMemberFilter` type: `"mostDomains" | "leastDomains" | "mostSkills" | "leastSkills" | "highestProficiency" | "lowestProficiency"`

2. Create `SKILLS_MEMBER_FILTER_TABS` array with labels: "Most Domains", "Least Domains", "Most Skills", "Least Skills", "Highest Proficiency", "Lowest Proficiency"

3. Create `skillsMemberSortFunction(rows, filter)` following the Performance tab sort pattern

4. Define `SkillsSkillFilter` type: `"mostUsage" | "leastUsage" | "mostContributors" | "leastContributors" | "highestCompletion" | "lowestCompletion"`

5. Create `SKILLS_SKILL_FILTER_TABS` and `skillsSkillSortFunction` for the "By Skill" view

6. Create `getSkillsInsights(members: MemberSkillsRow[])` returning `ChartInsight[]`:
   - 3-4 insights about member skill distribution
   - Reference specific member names (e.g., "Bob Martinez has the broadest skillset across 7 domains")
   - Use deterministic selection
  </action>
  <verify>
    Run `npx tsc --noEmit` to confirm no type errors in new files.
  </verify>
  <done>
    skillsMockData.ts exports MemberSkillsRow, MemberSkillRow types, getMemberSkillsData, getMemberSkillRows, computeDomainWeights. skillsHelpers.ts exports filter types, filter tabs, sort functions, and getSkillsInsights. Types align with SkillGraph and BaseTeamsTable interfaces.
  </done>
</task>

<task type="auto">
  <name>Task 2: Compose Skills Graph tab page with SkillGraph and dual-view table</name>
  <files>
    app/org/[orgId]/team/[teamId]/skillgraph/page.tsx
  </files>
  <action>
Replace the placeholder Skills Graph page with the full implementation. Follow the org Skills Graph page layout (`app/org/[orgId]/skillgraph/page.tsx`):

1. Add `"use client"` directive at top.

2. Import all required components:
   - `SkillGraph` from `@/components/skillmap/SkillGraph`
   - `BaseTeamsTable, BaseTeamsTableColumn` from `@/components/dashboard/BaseTeamsTable`
   - `DashboardSection` from `@/components/dashboard/DashboardSection`
   - `ChartInsights` from `@/components/dashboard/ChartInsights`
   - `Badge` from `@/components/shared/Badge`
   - `TeamAvatar` from `@/components/shared/TeamAvatar`
   - `TooltipProvider` from `@/components/ui/tooltip`
   - Mock data and helpers from `@/lib/teamDashboard/skillsMockData` and `skillsHelpers`

3. Define two sets of columns:
   a. `MEMBER_VIEW_COLUMNS` for "By Member" view:
      - Rank, Member (avatar + name), Domains (count), Skills (count), Total Usage, Avg Proficiency (percentage bar)
   b. `SKILL_VIEW_COLUMNS` for "By Skill" view:
      - Skill Name, Domain, Total Usage, Avg Usage, Skill Completion (percentage), Contributors

4. Page component `TeamSkillgraphPage`:
   - `useParams()` to get teamId
   - State: `skillgraphView` ("member" | "skill", default "member"), `memberFilter` (SkillsMemberFilter), `skillFilter` (SkillsSkillFilter), `visibleMembers` (Record<string, boolean>), `visibleDomains` (Record<string, boolean>)
   - Data: `useMemo` for `getMemberSkillsData(teamId)`, `getMemberSkillRows(memberSkills)`, `computeDomainWeights(memberSkills, visibleMembers)`, insights
   - Initialize `visibleMembers` all true, `visibleDomains` all true

5. Render layout mirroring org Skills Graph page:
   - Section 1: "Team Skills Graph" with `DashboardSection`
     - `ChartInsights` for insights
   - Section 2: SkillGraph centered in a 700x700 container
     - `SkillGraph` with `domainWeights` and `skillVisibility` (visibleDomains) props
   - Section 3: "Team Members" / "Skills" with `DashboardSection`
     - View toggle in action slot: "By Member" / "By Skill" pill buttons (matching org pattern with rounded-full bg-gray-100 styling)
     - When "By Member": show `BaseTeamsTable<MemberSkillsRow, SkillsMemberFilter>` with member columns and member filters
     - When "By Skill": show `BaseTeamsTable<MemberSkillRow, SkillsSkillFilter>` with skill columns and skill filters
     - Filter badges rendered above table in DashboardSection action slot (combined with view toggle)

6. Wrap entire return in `TooltipProvider`.

7. View toggle styling must match org page exactly: `inline-flex rounded-full bg-gray-100 p-1` with `px-4 py-2 text-xs font-semibold shadow-none rounded-full transition` buttons.
  </action>
  <verify>
    Run `npx tsc --noEmit` to confirm no type errors. Run `npm run build` to verify page compiles. Navigate to `/org/test-org/team/test-team/skillgraph` in browser to verify page renders.
  </verify>
  <done>
    Skills Graph tab renders with: SkillGraph showing aggregated member domain weights, "By Member" view showing member skill metrics in table, "By Skill" view showing per-skill aggregation across members, view toggle switches between views, filter tabs sort correctly in both views, ChartInsights shows member-specific skills insights.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `npm run build` completes successfully
3. Skills Graph tab page renders at team dashboard URL
4. SkillGraph receives aggregated domainWeights from member data
5. "By Member" view shows members with domain/skill counts
6. "By Skill" view shows skills with usage/completion across members
7. View toggle switches between views
8. Filter tabs change table sort order in both views
9. ChartInsights shows member-specific insights
</verification>

<success_criteria>
- SKILL-01: SkillGraph renders with member-aggregated domain weights
- SKILL-02: View toggle ("By Member" / "By Skill") switches table view correctly
- SKILL-03: Skill view table shows skill name, domain, total usage, skill completion, contributors
- SKILL-04: Filter tabs (Most/Least Domains, Most/Least Skills, Highest/Lowest Proficiency) sort correctly
- SKILL-05: ChartInsights panel shows 3-4 member-specific skills insights
</success_criteria>

<output>
After completion, create `.planning/phases/04-remaining-tabs/04-02-SUMMARY.md`
</output>
