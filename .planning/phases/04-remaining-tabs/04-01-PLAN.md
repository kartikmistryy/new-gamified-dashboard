---
phase: 04-remaining-tabs
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/teamDashboard/designMockData.ts
  - lib/teamDashboard/designHelpers.ts
  - app/org/[orgId]/team/[teamId]/design/page.tsx
autonomous: true

must_haves:
  truths:
    - "Design tab shows member ownership scatter plot with member data points"
    - "Design tab shows engineering chaos matrix with member chaos data"
    - "Design tab member table has ownership and chaos columns with filter tabs"
    - "Design tab ChartInsights panel shows member-level design insights"
    - "Filter tabs sort members by ownership health and chaos metrics"
  artifacts:
    - path: "lib/teamDashboard/designMockData.ts"
      provides: "Member design mock data generator"
      exports: ["getMemberDesignData"]
    - path: "lib/teamDashboard/designHelpers.ts"
      provides: "Design tab filter logic and insights"
      exports: ["getDesignInsights"]
    - path: "app/org/[orgId]/team/[teamId]/design/page.tsx"
      provides: "Design tab page composition"
      contains: "OwnershipScatter"
  key_links:
    - from: "app/org/[orgId]/team/[teamId]/design/page.tsx"
      to: "lib/teamDashboard/designMockData.ts"
      via: "import and useMemo"
      pattern: "getMemberDesignData"
    - from: "app/org/[orgId]/team/[teamId]/design/page.tsx"
      to: "components/dashboard/OwnershipScatter.tsx"
      via: "data prop with transformed member data"
      pattern: "OwnershipScatter.*data="
    - from: "app/org/[orgId]/team/[teamId]/design/page.tsx"
      to: "components/dashboard/ChaosMatrix.tsx"
      via: "data prop with member chaos data"
      pattern: "ChaosMatrix.*data="
---

<objective>
Implement the Design tab for the team dashboard, showing member-level ownership health and engineering chaos analysis.

Purpose: Enable users to analyze individual member ownership patterns and chaos index, mirroring the org dashboard Design tab layout exactly but with member-level data.
Output: Working Design tab at `/org/:orgId/team/:teamId/design` with OwnershipScatter, ChaosMatrix, BaseTeamsTable, and ChartInsights.
</objective>

<execution_context>
@/Users/kartikmistry/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kartikmistry/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-remaining-tabs/04-RESEARCH.md

@app/org/[orgId]/design/page.tsx
@app/org/[orgId]/team/[teamId]/performance/page.tsx
@lib/teamDashboard/overviewMockData.ts
@lib/teamDashboard/types.ts
@lib/orgDashboard/designMockData.ts
@lib/orgDashboard/types.ts
@components/dashboard/OwnershipScatter.tsx
@components/dashboard/ChaosMatrix.tsx
@components/dashboard/BaseTeamsTable.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Design mock data generator and helpers</name>
  <files>
    lib/teamDashboard/designMockData.ts
    lib/teamDashboard/designHelpers.ts
  </files>
  <action>
Create `lib/teamDashboard/designMockData.ts`:

1. Define a `MemberDesignRow` type extending the member identity pattern:
   - `memberName: string`, `teamId: string`
   - `totalKarmaPoints: number` (1k-50k range)
   - `ownershipPct: number` (0-30% range)
   - `medianWeeklyKp: number` (for chaos matrix x-axis)
   - `churnRatePct: number` (for chaos matrix y-axis, 0-60%)
   - `ownershipAllocation: [number, number, number]` (red/blue/green segments, matching org DesignTeamRow shape)
   - `engineeringChaos: [number, number, number, number]` (4 segments matching org DesignTeamRow shape)
   - `outlierScore`, `skilledAIScore`, `unskilledScore`, `legacyScore` (number scores for filter sorting)

2. Create `getMemberDesignData(teamId: string, memberCount?: number)` function:
   - Reuse `getMemberPerformanceRowsForTeam(52, teamId, memberCount)` from `overviewMockData.ts` to get base member names/data
   - Generate deterministic design metrics using the same `Math.sin(seed * 9999)` noise pattern from Performance tab
   - Use member name charCode + index as seed (proven pattern)
   - Generate `totalKarmaPoints` in 1k-50k range, `ownershipPct` in 2-28% range
   - Generate `medianWeeklyKp` in 500-3000 range, `churnRatePct` in 5-55% range
   - Calculate `ownershipAllocation` as 3-segment array summing to ~20-30 (matching org scale)
   - Calculate `engineeringChaos` as 4-segment array summing to ~15-25 (matching org scale)
   - Derive scores from generated metrics: `outlierScore` from KP/ownership delta, `skilledAIScore` from high KP + low churn, etc.

3. Create `transformToOwnershipScatterData(members: MemberDesignRow[])`:
   - Returns `DeveloperPoint[]` format matching OwnershipScatter props
   - Map member data to `{ name: memberName, team: teamId, totalKarmaPoints, ownershipPct, inNormalRange, outlierType }`
   - Determine `inNormalRange` and `outlierType` by comparing each member to group mean (>1 stddev from mean = outlier)

4. Create `transformToChaosMatrixData(members: MemberDesignRow[])`:
   - Returns `ChaosPoint[]` format matching ChaosMatrix props
   - Map member data to `{ team: memberName, name: memberName, medianWeeklyKp, churnRatePct }`
   - Note: `team` field is used as grouping label by ChaosMatrix; use member name so each member is a distinct "group"

Create `lib/teamDashboard/designHelpers.ts`:

1. Define `DesignMemberFilter` type with values: `"highestOwnership" | "lowestOwnership" | "skilledAI" | "traditionalDev" | "highestChaos" | "lowestChaos"`

2. Create `DESIGN_MEMBER_FILTER_TABS` array with labels: "Highest Ownership", "Lowest Ownership", "Skilled AI Users", "Traditional Devs", "Highest Chaos", "Lowest Chaos"

3. Create `designMemberSortFunction(rows, filter)` following the Performance tab sort pattern

4. Create `getDesignInsights(members: MemberDesignRow[])` returning `ChartInsight[]`:
   - 3-4 insights about member ownership patterns
   - Reference specific member names (e.g., "Alice Chen has the highest ownership concentration at 25%")
   - Use deterministic selection (first/last sorted members, not random)
  </action>
  <verify>
    Run `npx tsc --noEmit` to confirm no type errors in new files.
  </verify>
  <done>
    designMockData.ts exports getMemberDesignData, transformToOwnershipScatterData, transformToChaosMatrixData. designHelpers.ts exports DesignMemberFilter type, DESIGN_MEMBER_FILTER_TABS, designMemberSortFunction, and getDesignInsights. All types align with existing chart component prop interfaces.
  </done>
</task>

<task type="auto">
  <name>Task 2: Compose Design tab page with all components</name>
  <files>
    app/org/[orgId]/team/[teamId]/design/page.tsx
  </files>
  <action>
Replace the placeholder Design page with the full implementation. Follow the org Design page layout exactly (`app/org/[orgId]/design/page.tsx`):

1. Add `"use client"` directive at top.

2. Import all required components:
   - `OwnershipScatter` from `@/components/dashboard/OwnershipScatter`
   - `ChaosMatrix` from `@/components/dashboard/ChaosMatrix`
   - `BaseTeamsTable, BaseTeamsTableColumn` from `@/components/dashboard/BaseTeamsTable`
   - `DashboardSection` from `@/components/dashboard/DashboardSection`
   - `ChartInsights` from `@/components/dashboard/ChartInsights`
   - `TimeRangeFilter` from `@/components/dashboard/TimeRangeFilter`
   - `Badge` from `@/components/shared/Badge`
   - `TeamAvatar` from `@/components/shared/TeamAvatar`
   - `TooltipProvider` from `@/components/ui/tooltip`
   - Mock data and helpers from `@/lib/teamDashboard/designMockData` and `designHelpers`
   - `TIME_RANGE_OPTIONS, TimeRangeKey` from `@/lib/orgDashboard/timeRangeTypes`

3. Define `DESIGN_MEMBER_COLUMNS` following the Performance tab column pattern:
   - Rank column (w-14, bold for top 3)
   - Member column (TeamAvatar + name)
   - Ownership Health column (3-segment stacked bar using ownershipAllocation, red/blue/green)
   - Engineering Chaos column (4-segment stacked bar using engineeringChaos)
   - KP column (formatted number)
   - Ownership % column (formatted percentage)

4. Page component `TeamDesignPage`:
   - `useParams()` to get teamId
   - State: `ownershipRange`, `chaosRange` (TimeRangeKey, default "3m" and "max"), `designFilter` (DesignMemberFilter), `visibleMembers` (Record<string, boolean>)
   - Data: `useMemo` for `getMemberDesignData(teamId)`, transform functions for chart data, insights
   - Initialize `visibleMembers` with all members visible
   - `handleToggleVisibility` callback

5. Render layout mirroring org Design page exactly:
   - Section 1: "Ownership Misallocation Detector" with `DashboardSection`, `TimeRangeFilter` in action slot
     - 65/35 flex row: `OwnershipScatter` (with `data` and `range` props) | `ChartInsights`
   - Section 2: "Engineering Chaos Matrix" with `DashboardSection`, `TimeRangeFilter` in action slot
     - `ChaosMatrix` with `data`, `range`, `visibleTeams` (member names), `teamNames` props
   - Section 3: "Team Members" with `DashboardSection`, filter Badge buttons in action slot
     - `BaseTeamsTable` with MemberDesignRow type, filter tabs, sort function, columns

6. Wrap entire return in `TooltipProvider` (required for chart tooltips per research pitfall #6).

7. Filter badges rendered outside BaseTeamsTable following the org Design page pattern (lines 83-96 of org design page).
  </action>
  <verify>
    Run `npx tsc --noEmit` to confirm no type errors. Run `npm run build` to verify page compiles. Navigate to `/org/test-org/team/test-team/design` in browser to verify page renders.
  </verify>
  <done>
    Design tab renders with: OwnershipScatter showing member data points, ChaosMatrix showing member chaos positions, member table with ownership/chaos columns, filter tabs sorting members by 6 different criteria, ChartInsights showing member-specific design insights. Layout matches org Design tab exactly.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `npm run build` completes successfully
3. Design tab page renders at team dashboard URL
4. OwnershipScatter receives member-level DeveloperPoint[] data (not default synthetic data)
5. ChaosMatrix receives member-level ChaosPoint[] data
6. BaseTeamsTable renders all members with correct columns
7. Filter tabs change table sort order
8. ChartInsights shows member-specific insights
</verification>

<success_criteria>
- DSGN-01: OwnershipScatter chart renders with member ownership data points
- DSGN-02: ChaosMatrix chart renders with member chaos index data
- DSGN-03: BaseTeamsTable shows members with ownership allocation and chaos columns
- DSGN-04: 6 filter tabs (Highest/Lowest Ownership, Skilled AI, Traditional Dev, Highest/Lowest Chaos) sort correctly
- DSGN-05: ChartInsights panel shows 3-4 member-specific design insights
</success_criteria>

<output>
After completion, create `.planning/phases/04-remaining-tabs/04-01-SUMMARY.md`
</output>
