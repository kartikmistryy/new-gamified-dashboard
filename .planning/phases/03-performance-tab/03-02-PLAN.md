---
phase: 03-performance-tab
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - components/dashboard/MemberPerformanceChart.tsx
  - components/dashboard/TimeRangeFilter.tsx
  - app/org/[orgId]/team/[teamId]/performance/page.tsx
autonomous: true

must_haves:
  truths:
    - "Performance chart displays team average line in aggregate view mode"
    - "Performance chart displays individual colored member lines in individual view mode"
    - "View toggle switches between Team Aggregate and Individual Members modes"
    - "Time range buttons (1M, 3M, 1Y, Max) filter chart data, defaulting to 1 Month"
    - "Disabled time range buttons are grayed out when insufficient data exists"
    - "Filter tabs (6 types) affect which members appear on the Individual Members chart"
    - "Member table shows Rank, Name, Effective Performance, Change, and Churn Rate columns"
    - "ChartInsights panel displays performance trend insights"
    - "Chart animates smoothly (500ms ease-in-out) when switching time ranges"
  artifacts:
    - path: "components/dashboard/MemberPerformanceChart.tsx"
      provides: "Recharts LineChart with view toggle support"
      min_lines: 80
    - path: "components/dashboard/TimeRangeFilter.tsx"
      provides: "Extended with disabled option support"
      contains: "disabled"
    - path: "app/org/[orgId]/team/[teamId]/performance/page.tsx"
      provides: "Complete Performance tab page"
      min_lines: 80
  key_links:
    - from: "app/org/[orgId]/team/[teamId]/performance/page.tsx"
      to: "lib/teamDashboard/performanceHelpers.ts"
      via: "imports helper functions"
      pattern: "import.*performanceHelpers"
    - from: "app/org/[orgId]/team/[teamId]/performance/page.tsx"
      to: "components/dashboard/MemberPerformanceChart.tsx"
      via: "renders chart component"
      pattern: "MemberPerformanceChart"
    - from: "app/org/[orgId]/team/[teamId]/performance/page.tsx"
      to: "lib/teamDashboard/performanceMockData.ts"
      via: "generates time-series data"
      pattern: "generateMemberPerformanceTimeSeries"
    - from: "components/dashboard/MemberPerformanceChart.tsx"
      to: "recharts"
      via: "LineChart, Line, ResponsiveContainer"
      pattern: "from.*recharts"
    - from: "app/org/[orgId]/team/[teamId]/performance/page.tsx"
      to: "components/dashboard/TimeRangeFilter.tsx"
      via: "renders time range filter with disabled options"
      pattern: "TimeRangeFilter"
---

<objective>
Build the MemberPerformanceChart component and compose the Performance tab page, wiring together the view toggle, time range filter, chart, member table with performance-specific filter tabs, and insights panel.

Purpose: This plan creates the complete Performance tab UI by combining the data layer from Plan 01 with Recharts visualization and existing dashboard components. The user can toggle between aggregate/individual views, filter by time range, and see filter-driven chart updates.
Output: Working Performance tab at `/org/:orgId/team/:teamId/performance` with interactive chart, time range controls, view toggle, member table, and insights panel.
</objective>

<execution_context>
@/Users/kartikmistry/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kartikmistry/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-performance-tab/03-RESEARCH.md
@.planning/phases/03-performance-tab/03-01-SUMMARY.md

@lib/teamDashboard/types.ts
@lib/teamDashboard/performanceTypes.ts
@lib/teamDashboard/performanceHelpers.ts
@lib/teamDashboard/performanceMockData.ts
@lib/teamDashboard/overviewMockData.ts
@lib/orgDashboard/timeRangeTypes.ts
@lib/orgDashboard/colors.ts
@lib/orgDashboard/types.ts
@components/dashboard/TimeRangeFilter.tsx
@components/dashboard/MemberTable.tsx
@components/dashboard/ChartInsights.tsx
@components/dashboard/OrgPerformanceChart.tsx
@components/ui/toggle-group.tsx
@app/org/[orgId]/team/[teamId]/performance/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend TimeRangeFilter for disabled support and create MemberPerformanceChart</name>
  <files>
    components/dashboard/TimeRangeFilter.tsx
    components/dashboard/MemberPerformanceChart.tsx
  </files>
  <action>
    1. **Extend TimeRangeFilter.tsx** to support a `disabled` property on options:
    - Change the options type from `Array<{ id: T; label: string }>` to `Array<{ id: T; label: string; disabled?: boolean }>`
    - When `opt.disabled` is true: apply gray styling (`bg-gray-100 text-gray-400 cursor-not-allowed`), set `aria-disabled="true"`, and do NOT call `onChange` on click
    - When `opt.disabled` is false/undefined: existing behavior unchanged
    - This is a backward-compatible change -- existing callers pass no `disabled` field and behavior is identical

    2. **Create `components/dashboard/MemberPerformanceChart.tsx`** as a new "use client" component:

    Props type:
    ```typescript
    type MemberPerformanceChartProps = {
      data: MemberPerformanceDataPoint[];
      members: MemberPerformanceRow[];
      viewMode: ViewMode;
      visibleMembers: Set<string>;
      timeRange: TimeRangeKey;
    };
    ```

    Implementation:
    - Import Recharts: `LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer` from "recharts"
    - Import types from `@/lib/teamDashboard/performanceTypes` and `@/lib/teamDashboard/types`
    - Import `DASHBOARD_COLORS` from `@/lib/orgDashboard/colors`
    - Import `TimeRangeKey` from `@/lib/orgDashboard/timeRangeTypes`

    **Color assignment:** Define MEMBER_LINE_COLORS array using DASHBOARD_COLORS (excellent, warning, danger, caution, stable, "#2563eb"). Assign colors to members by index cycling.

    **Chart data transformation (useMemo):**
    - Aggregate mode: map data to `{ date, teamAverage: point.value }`
    - Individual mode: map data to `{ date, ...point.memberValues }` (spread member values as separate keys)

    **X-axis formatting:**
    - For 1m/3m: show MM/DD format
    - For 1y/max: show "Mon YYYY" format

    **Empty state:** If data.length === 0, render a div with "No data available for selected time range" message (gray bg, centered text, 400px height)

    **Rendering:**
    - ResponsiveContainer width="100%" height={400}
    - CartesianGrid strokeDasharray="3 3" stroke="#e5e7eb"
    - XAxis dataKey="date" with tickFormatter, stroke="#9ca3af", fontSize 11
    - YAxis domain={[0, 100]}, stroke="#9ca3af", fontSize 11, label "Performance Value" rotated -90
    - Tooltip with white bg, gray border, rounded, fontSize 12, labelFormatter showing "Mon DD, YYYY"
    - Aggregate mode: single Line for "teamAverage" with stroke="#2563eb", strokeWidth 2, dot r=3, isAnimationActive=true, animationDuration=500, animationEasing="ease-in-out"
    - Individual mode: map over members filtered by visibleMembers, render Line for each with unique color from memberColors map. Include Legend at bottom. Same animation settings (500ms, ease-in-out).
    - Use `name` prop on Line to set display name (prevents tooltip showing wrong names per research pitfall #7)

    Per user decisions:
    - Animation: 500ms duration, ease-in-out easing
    - Colors: DASHBOARD_COLORS palette cycling through members
  </action>
  <verify>Run `npx tsc --noEmit` to confirm no type errors. Verify TimeRangeFilter still works for existing callers (no breaking change to options type). Verify MemberPerformanceChart exports correctly.</verify>
  <done>TimeRangeFilter supports disabled options with gray styling and aria-disabled. MemberPerformanceChart renders Recharts LineChart in aggregate (single line) or individual (multi-line) mode with 500ms animations. Both compile without errors.</done>
</task>

<task type="auto">
  <name>Task 2: Compose Performance tab page with all components and state management</name>
  <files>
    app/org/[orgId]/team/[teamId]/performance/page.tsx
  </files>
  <action>
    Replace the placeholder Performance page with the full implementation. The page is "use client".

    **Imports:**
    - React: useMemo, useState
    - Next: useParams from "next/navigation"
    - UI: Card, CardContent from "@/components/ui/card", ToggleGroup + ToggleGroupItem from "@/components/ui/toggle-group", TooltipProvider from "@/components/ui/tooltip"
    - Dashboard: TimeRangeFilter, MemberPerformanceChart, ChartInsights from "@/components/dashboard/"
    - Data: getMemberPerformanceRowsForTeam from "@/lib/teamDashboard/overviewMockData"
    - Data: generateMemberPerformanceTimeSeries from "@/lib/teamDashboard/performanceMockData"
    - Helpers: filterByTimeRange, smartSample, isTimeRangeSufficient, getVisibleMembersForFilter, getPerformanceInsights from "@/lib/teamDashboard/performanceHelpers"
    - Types: TimeRangeKey from "@/lib/orgDashboard/timeRangeTypes", ViewMode + PerformanceFilter from "@/lib/teamDashboard/performanceTypes"

    **State:**
    - `viewMode: ViewMode` initialized to "aggregate"
    - `timeRange: TimeRangeKey` initialized to "1m" (per user decision: default 1 Month)
    - `activeFilter: PerformanceFilter` initialized to "mostProductive"

    **Data pipeline (all useMemo):**
    1. `members` = getMemberPerformanceRowsForTeam(52, teamId, 6) -- stable team performance value, 6 members
    2. `rawData` = generateMemberPerformanceTimeSeries(members)
    3. `timeFilteredData` = filterByTimeRange(rawData, timeRange) -- filter FIRST
    4. `sampledData` = smartSample(timeFilteredData) -- sample SECOND (correct order per research)
    5. `visibleMembers` = getVisibleMembersForFilter(members, activeFilter, viewMode)
    6. `timeRangeOptions` = map TIME_RANGE_OPTIONS adding disabled based on isTimeRangeSufficient(rawData, opt.id)
    7. `insights` = getPerformanceInsights(members, sampledData, timeRange)

    **MemberTable for Performance tab:**
    The existing MemberTable uses MemberTableFilter ("mostProductive" | "leastProductive" | "mostOptimal" | "mostRisky") which has different filter tabs than Performance needs. For the Performance tab, create a PERFORMANCE_FILTER_TABS array and render a BaseTeamsTable directly (same pattern as MemberTable but with Performance-specific columns and filter tabs).

    Performance filter tabs:
    ```
    { key: "mostProductive", label: "Most Productive" }
    { key: "leastProductive", label: "Least Productive" }
    { key: "mostImproved", label: "Most Improved" }
    { key: "mostRegressed", label: "Most Regressed" }
    { key: "highestChurn", label: "Highest Churn" }
    { key: "lowestChurn", label: "Lowest Churn" }
    ```

    Performance table columns (per requirement PERF-03):
    - Rank: index + 1, bold for top 3
    - Member: avatar + name (reuse TeamAvatar pattern from MemberTable)
    - Effective Performance: performance badge with color and trend icon (same render as MemberTable)
    - Change: show `change` value with +/- prefix, green for positive, red for negative, gray for zero
    - Churn Rate: show `churnRate` value with % suffix

    Performance sort function:
    - "mostProductive": sort by performanceValue desc
    - "leastProductive": sort by performanceValue asc
    - "mostImproved": sort by change desc
    - "mostRegressed": sort by change asc
    - "highestChurn": sort by churnRate desc
    - "lowestChurn": sort by churnRate asc

    **Layout** (match org dashboard and Overview tab pattern):
    ```
    <TooltipProvider>
      <div className="flex flex-col gap-8 px-6 pb-8 min-h-screen bg-white text-gray-900">
        <Card className="w-full border-none bg-white p-0 shadow-none">
          <CardContent className="flex w-full flex-col items-stretch space-y-8 px-0">
            <h2>Performance</h2>

            <!-- Controls row: view toggle left, time range right -->
            <div className="flex items-center justify-between">
              <ToggleGroup>...</ToggleGroup>
              <TimeRangeFilter options={timeRangeOptions} value={timeRange} onChange={setTimeRange} />
            </div>

            <!-- Chart + insights row -->
            <div className="flex flex-row gap-5">
              <div className="flex-1">
                <MemberPerformanceChart ... />
              </div>
              <ChartInsights insights={insights} />
            </div>

            <!-- Member table section -->
            <section>
              <h2>Team Members</h2>
              <BaseTeamsTable ... />  <!-- with Performance columns and filter tabs -->
            </section>
          </CardContent>
        </Card>
      </div>
    </TooltipProvider>
    ```

    Key integration points:
    - `activeFilter` state drives BOTH the table filter tabs AND the chart visibility (via getVisibleMembersForFilter)
    - When user switches filter tab, table re-sorts AND chart shows only matching members (in individual view)
    - When user toggles view mode, chart switches rendering but filter state persists
    - ToggleGroup uses `type="single"` with `onValueChange` handler that ignores empty values

    Anti-patterns to avoid:
    - Do NOT import MemberTable directly (it has different filter tabs). Use BaseTeamsTable with Performance-specific columns.
    - Do NOT animate on filter tab changes (only time range switches trigger animation per research)
    - Do NOT forget to connect activeFilter to both chart visibility AND table filtering
  </action>
  <verify>Run `npx tsc --noEmit` to confirm no type errors. Run `npm run build` to verify the page compiles for production. Navigate to `/org/1/team/1/performance` in dev server and verify the page renders (not the placeholder).</verify>
  <done>Performance tab at `/org/:orgId/team/:teamId/performance` renders with: (1) view toggle between Team Aggregate and Individual Members, (2) time range filter with disabled states, (3) Recharts line chart with animation, (4) ChartInsights panel, (5) member table with 6 performance-specific filter tabs and Rank/Name/Performance/Change/Churn columns. Default view is aggregate mode with 1 Month range.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with zero errors
- `npm run build` succeeds
- Performance tab page replaces placeholder content
- View toggle switches between single aggregate line and multiple member lines
- Time range buttons filter chart data (1M default, grayed out if insufficient data)
- Filter tabs affect member table sorting AND chart visibility in individual mode
- ChartInsights panel shows 3-4 performance trend insights
- Chart animations are smooth (500ms, ease-in-out) on time range changes
- Layout matches Overview tab pattern (gap-8, gap-5, Card, TooltipProvider)
</verification>

<success_criteria>
A user navigating to the team Performance tab sees a working time-series chart with view toggle, time range controls with smart disabling, a member performance table with 6 filter tabs showing Rank/Name/Performance/Change/Churn columns, and a contextual insights panel. All interactions (view toggle, time range, filter tabs) update the chart and table correctly. The page matches the visual consistency of the Overview tab.
</success_criteria>

<output>
After completion, create `.planning/phases/03-performance-tab/03-02-SUMMARY.md`
</output>
